<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户注册</title>
    <link rel="stylesheet" href="register.css">
    <style>	* {
        /* 初始化 清除页面元素的内外边距 */
        padding: 0;
        margin: 0;
        /* 盒子模型 */
        box-sizing: border-box;
    }
    body {
        /* 弹性布局 让页面元素垂直+水平居中 */
        display: flex;
        justify-content: center;
        align-items: center;
        /* 让页面始终占浏览器可视区域总高度 */
        height: 100vh;
        /* 背景渐变色 */
        background: linear-gradient(#141e30, #243b55);
    }
    .register {
        /* 弹性布局 让子元素称为弹性项目 */
        display: flex;
        /* 让弹性项目垂直排列 原理是改变弹性盒子的主轴方向 父元素就是弹性盒子 现在改变后的主轴方向是向下了 */
        flex-direction: column;
        /* 让弹性项目在交叉轴方向水平居中 现在主轴的方向是向下 交叉轴的方向是与主轴垂直 交叉轴的方向是向右 */
        align-items: center;
        width: 400px;
        padding: 40px;
        background-color: rgba(0, 0, 0, 0.2);
        box-shadow: 0 15px 25px rgba(0, 0, 0, 0.4);
    }
    .register h2 {
        color: #fff;
        margin-bottom: 30px;
    }
    .register .register_box {
        /* 相对定位 */
        position: relative;
        width: 100%;
    }
    .register .register_box input {
        /* 清除input框自带的边框和轮廓 */
        outline: none;
        border: none;
        width: 100%;
        padding: 10px 0;
        margin-bottom: 30px;
        color: #fff;
        font-size: 16px;
        border-bottom: 1px solid #fff;
        /* 背景颜色为透明色 */
        background-color: transparent;
    }
    .register .register_box label {
        position: absolute;
        top: 0;
        left: 0;
        padding: 10px 0;
        color: #fff;
        /* 这个属性的默认值是auto 默认是这个元素可以被点击 但是如果我们写了none 就是这个元素不能被点击 , 就好像它可见但是不能用 可望而不可即 */
        /* 这个就是两者的区别 */
        pointer-events: none;
        /* 加个过渡 */
        transition: all 0.5s;
    }
    /* :focus 选择器是当input获得焦点是触发的样式 + 是相邻兄弟选择器 去找与input相邻的兄弟label */
    /* :valid 选择器是判断input框的内容是否合法,如果合法会执行下面的属性代码,不合法就不会执行,我们刚开始写布局的时候给input框写了required 我们删掉看对比 当没有required的话input框的值就会被认为一直合法,所以一直都是下方的样式 ,但是密码不会,密码框内的值为空,那么这句话局不合法,required不能为空 当我们给密码框写点东西的时候才会执行以下代码*/
    .register .register_box input:focus + label,
    .register .register_box input:valid + label {
        top: -20px;
        color: #03e9f4;
        font-size: 12px;
    }
    .register button {
        overflow: hidden;
        position: relative;
        padding: 10px 20px;
        color: #03e9f4;
        background-color: rgb(19, 139, 131);
        border-radius: 20px;
        /* 取消a表现原有的下划线 */
        text-decoration: none;
        /* 同样加个过渡 */
        transition: all 0.5s;
    }
    .register button:hover {
        color: #ffffff;
        border-radius: 5px;
        background-color: #03e9f4;
        box-shadow: 0 0 5px #03e9f4, 0 0 25px #03e9f4, 0 0 50px #03e9f4,
            0 0 100px #03e9f4;
    }
    .register button span {
        position: absolute;
    }
    .register button span:first-child {
        top: 0;
        left: -100%;
        width: 100%;
        height: 2px;
        /* to right 就是往右边 下面的同理 */
        background: linear-gradient(to right, transparent, #03e9f4);
        /* 动画 名称 时长 linear是匀速运动 infinite是无限次运动 */
        animation: move1 1s linear infinite;
    }
    .register button span:nth-child(2) {
        right: 0;
        top: -100%;
        width: 2px;
        height: 100%;
        background: linear-gradient(transparent, #03e9f4);
        /* 这里多了个0.25s其实是延迟时间 */
        animation: move2 1s linear 0.25s infinite;
    }
    .register button span:nth-child(3) {
        right: -100%;
        bottom: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(to left, transparent, #03e9f4);
        animation: move3 1s linear 0.5s infinite;
    }
    .register button span:last-child {
        left: 0;
        bottom: -100%;
        width: 2px;
        height: 100%;
        background: linear-gradient(#03e9f4, transparent);
        animation: move4 1s linear 0.75s infinite;
    }
    /* 写一下动画 再坚持一下 视频马上就完了 */
    @keyframes move1 {
        0% {
            left: -100%;
        }
        50%,
        100% {
            left: 100%;
        }
    }
    @keyframes move2 {
        0% {
            top: -100%;
        }
        50%,
        100% {
            top: 100%;
        }
    }
    @keyframes move3 {
        0% {
            right: -100%;
        }
        50%,
        100% {
            right: 100%;
        }
    }
    @keyframes move4 {
        0% {
            bottom: -100%;
        }
        50%,
        100% {
            bottom: 100%;
        }
    }</style>
</head>
<body>
    <div class="register">
        <h2>用户注册</h2>
        <div class="register_box">
            <input type="text" id="id" required>
            <label for="id">ID</label>
        </div>
        <div class="register_box">
            <input type="text" id="name" required>
            <label for="name">Name</label>
        </div>
        <div class="register_box">
            <input type="email" id="email" required>
            <label for="email">Email</label>
        </div>
        <div class="register_box">
            <input type="password" id="password" required minlength="4">
            <label for="password">Password (At least 4 characters)</label>
        </div>
        <div class="register_box">
            <input type="password" id="password_confirm" required minlength="4">
            <label for="password_confirm">confirm your password</label>
        </div>
        <button id="registerBtn" onclick="registerUser()"> 注册
            <span></span>
            <span></span>
            <span></span>
            <span></span>
        </button>
       
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

   
    <script>
       
     
       function checkPassword() {
            var password = document.getElementById("password").value;
            var confirmPassword = document.getElementById("password_confirm").value;

            if (password !== confirmPassword) {
                alert("密码不匹配，请重新输入！");
                return false;
            }
            if (password.length < 4) {
                alert("密码长度必须大于4位！");
                return false;
            }
            return true;
        }
        function validateEmail() {
            var email = document.getElementById("email").value;
            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailRegex.test(email)) {
                alert("请输入有效的邮箱地址！");
                return false;
            }
            return true;
        }
        


        function registerUser() {
  if (checkPassword() && validateEmail()) {
    var id = document.getElementById("id").value;
    var name = document.getElementById("name").value;
    var email = document.getElementById("email").value;
    var password = document.getElementById("password").value;

    // Check if ID is already registered
    $.ajax({
      url: '/check_duplicate_id',
      method: 'POST',
      data: { id: id },
      success: function(response) {
        if (response === 'duplicate_id') {
          alert("该ID已被注册，请使用其他ID！");
        } else {
          // ID is not duplicate, proceed with registration
          $.ajax({
            url: '/register',
            method: 'POST',
            data: {
              id: id,
              name: name,
              email: email,
              password: password
            },
            success: function(response) {
              console.log(response);
              // 注册成功后跳转到根页面
              window.location.href = "/";
            },
            error: function(xhr, status, error) {
              console.error(error);
              // 停留在注册页面
            }
          });
        }
      },
      error: function(xhr, status, error) {
        console.error(error);
      }
    });
  }
}
    </script>
    
</body>
</html>
